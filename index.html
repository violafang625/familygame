<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…„å¦¹å± é¾å‚³èªª</title>
    <style>
        :root {
            --primary-boy: #4facfe;
            --primary-girl: #ff9a9e;
            --bg-color: #f4f7f6;
            --card-bg: #ffffff;
            --boss-hp-color: #ff4757;
        }
        body { font-family: 'å¾®è»Ÿæ­£é»‘é«”', sans-serif; background-color: var(--bg-color); margin: 0; padding: 20px; user-select: none; padding-bottom: 80px; }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* é ‚éƒ¨å°èˆª */
        .nav-bar { display: flex; justify-content: space-between; background: white; padding: 10px; border-radius: 30px; box-shadow: 0 5px 15px rgba(0,0,0,0.05); margin-bottom: 20px; position: sticky; top: 10px; z-index: 100; }
        .nav-item { flex: 1; text-align: center; padding: 10px; border-radius: 25px; cursor: pointer; transition: 0.3s; font-weight: bold; color: #888; }
        .nav-item.active-boy { background: var(--primary-boy); color: white; transform: scale(1.05); }
        .nav-item.active-girl { background: var(--primary-girl); color: white; transform: scale(1.05); }
        .nav-item.active-boss { background: #6c5ce7; color: white; transform: scale(1.05); }

        /* é é¢åˆ‡æ› */
        .page { display: none; animation: fadeIn 0.5s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* è§’è‰²å¡ç‰‡ */
        .profile-card { background: white; border-radius: 20px; padding: 20px; text-align: center; box-shadow: 0 10px 25px rgba(0,0,0,0.05); margin-bottom: 20px; position: relative; overflow: hidden; }
        .boy-theme .profile-card { border-top: 5px solid var(--primary-boy); }
        .girl-theme .profile-card { border-top: 5px solid var(--primary-girl); }
        
        .avatar { font-size: 60px; display: inline-block; animation: bounce 2s infinite; }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }

        .milestone-box { background: #fff8e1; border: 2px dashed #ffc107; border-radius: 10px; padding: 10px; margin-top: 15px; font-size: 14px; color: #d35400; text-align: left; }
        .milestone-icon { font-size: 20px; vertical-align: middle; margin-right: 5px; }

        /* é€²åº¦æ¢ */
        .progress-container { background: #eee; height: 15px; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        .progress-bar { height: 100%; width: 0%; transition: width 0.5s ease; }
        .boy-theme .progress-bar { background: linear-gradient(90deg, #4facfe, #00f2fe); }
        .girl-theme .progress-bar { background: linear-gradient(90deg, #ff9a9e, #fecfef); }

        /* ä»»å‹™æŒ‰éˆ•ç¶²æ ¼ */
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; } /* æ”¹æˆ3åˆ— */
        
        button { border: none; border-radius: 15px; padding: 10px 5px; cursor: pointer; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.05); color: #444; height: 100px; position: relative; overflow: hidden; }
        button:active { transform: scale(0.95); }
        
        .emoji { font-size: 30px; display: block; margin-bottom: 5px; }
        .task-name { font-size: 14px; font-weight: bold; display: block; line-height: 1.2; }
        .points { font-size: 12px; font-weight: bold; margin-top: 5px; display: block; }
        
        .btn-task { border-bottom: 3px solid #81c784; }
        .btn-task .points { color: #2e7d32; }
        
        .btn-reward { border-bottom: 3px solid #e57373; background: #fff5f5; }
        .btn-reward .points { color: #c62828; }

        /* ----------- BOSS æˆ°é¬¥å€æ¨£å¼ ----------- */
        .boss-arena { text-align: center; background: url('https://www.transparenttextures.com/patterns/cubes.png'), linear-gradient(135deg, #1e1e2e 0%, #2d3436 100%); color: white; border-radius: 20px; padding: 30px 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
        .boss-avatar { font-size: 100px; margin: 20px 0; display: inline-block; filter: drop-shadow(0 0 10px rgba(255,0,0,0.5)); transition: 0.1s; }
        .boss-name { font-size: 24px; font-weight: bold; margin-bottom: 5px; color: #ff7675; }
        .boss-desc { font-size: 14px; color: #b2bec3; margin-bottom: 20px; }
        
        .hp-bar-container { width: 100%; height: 30px; background: #555; border-radius: 15px; overflow: hidden; border: 3px solid #444; position: relative; }
        .hp-bar { height: 100%; background: linear-gradient(90deg, #ff4757, #ff6b81); width: 100%; transition: width 0.3s ease-out; }
        .hp-text { position: absolute; width: 100%; text-align: center; top: 0; line-height: 28px; font-weight: bold; text-shadow: 1px 1px 2px black; font-size: 16px; }

        .hit-effect { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translate(1px, 1px) rotate(0deg); } 10% { transform: translate(-1px, -2px) rotate(-1deg); } 20% { transform: translate(-3px, 0px) rotate(1deg); } 30% { transform: translate(3px, 2px) rotate(0deg); } 40% { transform: translate(1px, -1px) rotate(1deg); } 50% { transform: translate(-1px, 2px) rotate(-1deg); } 60% { transform: translate(-3px, 1px) rotate(0deg); } 70% { transform: translate(3px, 1px) rotate(-1deg); } 80% { transform: translate(-1px, -1px) rotate(1deg); } 90% { transform: translate(1px, 2px) rotate(0deg); } 100% { transform: translate(1px, -2px) rotate(-1deg); } }

        /* ç´€éŒ„å€ */
        .log-area { margin-top: 20px; background: white; padding: 15px; border-radius: 15px; max-height: 200px; overflow-y: auto; font-size: 13px; color: #666; text-align: left; }
        .log-item { padding: 8px 0; border-bottom: 1px dashed #eee; display: flex; justify-content: space-between; }

    </style>
</head>
<body class="boy-theme">

<div class="container">
    
    <div class="nav-bar">
        <div class="nav-item active-boy" onclick="switchPage('boy')">ğŸ‘¦ å“¥å“¥</div>
        <div class="nav-item" onclick="switchPage('girl')">ğŸ‘§ å¦¹å¦¹</div>
        <div class="nav-item" onclick="switchPage('boss')">ğŸ‘¹ è¨ä¼æˆ°</div>
    </div>

    <div id="page-boy" class="page active">
        </div>

    <div id="page-girl" class="page">
        </div>

    <div id="page-boss" class="page">
        <div class="boss-arena" id="boss-arena">
            <div class="boss-name" id="boss-name">Loading...</div>
            <div class="boss-desc" id="boss-desc">æ­£åœ¨å°‹æ‰¾æ€ªç‰©...</div>
            <div class="boss-avatar" id="boss-avatar">ğŸ‘¾</div>
            
            <div class="hp-bar-container">
                <div class="hp-bar" id="boss-hp-bar"></div>
                <div class="hp-text" id="boss-hp-text">100 / 100</div>
            </div>
            
            <p style="margin-top:20px; color:#dfe6e9; font-size:14px;">
                ğŸ’¡ æç¤ºï¼šå“¥å“¥å’Œå¦¹å¦¹åªè¦å®Œæˆä»»å‹™ç²å¾— XPï¼Œ<br>å°±æœƒè‡ªå‹•å°æ€ªç¸é€ æˆå‚·å®³å–”ï¼
            </p>
            <div style="margin-top:20px;" id="boss-log"></div>
        </div>
    </div>

</div>

<template id="player-template">
    <div class="profile-card">
        <div class="avatar">ğŸ¦¸</div>
        <div><span class="level-badge">Lv.1</span></div>
        <h2 style="margin:5px 0" class="player-score">0</h2>
        <div class="progress-container"><div class="progress-bar"></div></div>
        
        <div class="milestone-box">
            <span class="milestone-icon">ğŸ</span>
            <span class="next-reward">ä¸‹å€‹çå‹µï¼šçœ‹é›»è¦– 10 åˆ†é˜ (100åˆ†)</span>
        </div>
    </div>

    <h3 style="color:#555; margin-left:5px;">ğŸ›¡ï¸ è‹±é›„ä»»å‹™ (æ”»æ“Šæ€ªç¸ï¼)</h3>
    <div class="grid">
        <button class="btn-task" onclick="handleTask(5, 'æº–æ™‚åˆ·ç‰™')"><span class="emoji">ğŸª¥</span><span class="task-name">åˆ·ç‰™</span><span class="points">+5 XP</span></button>
        <button class="btn-task" onclick="handleTask(5, 'å–æ°´')"><span class="emoji">ğŸ’§</span><span class="task-name">å–æ°´</span><span class="points">+5 XP</span></button>
        <button class="btn-task" onclick="handleTask(10, 'åƒé’èœ')"><span class="emoji">ğŸ¥¦</span><span class="task-name">åƒé’èœ</span><span class="points">+10 XP</span></button>
        <button class="btn-task" onclick="handleTask(15, 'é–±è®€')"><span class="emoji">ğŸ“–</span><span class="task-name">çœ‹æ›¸</span><span class="points">+15 XP</span></button>
        <button class="btn-task" onclick="handleTask(10, 'å®ŒæˆåŠŸèª²')"><span class="emoji">âœï¸</span><span class="task-name">å¯«åŠŸèª²</span><span class="points">+10 XP</span></button>
        <button class="btn-task" onclick="handleTask(5, 'æ•´ç†æ›¸åŒ…')"><span class="emoji">ğŸ’</span><span class="task-name">æ•´ç†æ›¸åŒ…</span><span class="points">+5 XP</span></button>
        <button class="btn-task" onclick="handleTask(20, 'åšå®¶äº‹')"><span class="emoji">ğŸ§¹</span><span class="task-name">åšå®¶äº‹</span><span class="points">+20 XP</span></button>
        <button class="btn-task" onclick="handleTask(5, 'æº–æ™‚ç¡è¦º')"><span class="emoji">ğŸŒ™</span><span class="task-name">æº–æ™‚ç¡è¦º</span><span class="points">+5 XP</span></button>
        <button class="btn-task" onclick="promptTask()"><span class="emoji">âœ¨</span><span class="task-name">å…¶ä»–å¥½äº‹</span><span class="points">+? XP</span></button>
    </div>

    <h3 style="color:#555; margin-left:5px;">ğŸ’ çå‹µå…Œæ›</h3>
    <div class="grid">
        <button class="btn-reward" onclick="handleTask(-50, 'çœ‹å½±ç‰‡')"><span class="emoji">ğŸ“º</span><span class="task-name">çœ‹å½±ç‰‡</span><span class="points">-50 åˆ†</span></button>
        <button class="btn-reward" onclick="handleTask(-30, 'åƒé»å¿ƒ')"><span class="emoji">ğŸª</span><span class="task-name">åƒé»å¿ƒ</span><span class="points">-30 åˆ†</span></button>
        <button class="btn-reward" onclick="handleTask(-100, 'è²·ç©å…·')"><span class="emoji">ğŸ¤–</span><span class="task-name">è²·å°ç©å…·</span><span class="points">-100 åˆ†</span></button>
    </div>

    <div class="log-area"></div>
</template>

<script>
    // --- éŠæˆ²è³‡æ–™è¨­å®š ---
    let currentPlayer = 'boy'; // 'boy' or 'girl'
    
    // é‡Œç¨‹ç¢‘è¨­å®š (å¯è‡ªè¡Œä¿®æ”¹)
    const milestones = [
        { score: 100, reward: "çœ‹é›»è¦– 10 åˆ†é˜" },
        { score: 300, reward: "å»å…¬åœ’ç© / é¸ä¸€å€‹é»å¿ƒ" },
        { score: 500, reward: "ç²å¾—ä¸€å¼µé¡˜æœ›å¡" },
        { score: 1000, reward: "å»éŠæ¨‚åœ’ / è²·å¤§ç©å…·" }
    ];

    // æ€ªç¸åˆ—è¡¨
    const monsters = [
        { name: "æ‡¶æƒ°å²èŠå§†", hp: 100, maxHp: 100, avatar: "ğŸ¦ ", desc: "æœ€å–œæ­¡è®“äººä¸æƒ³å‹•çš„é»é»æ€ª" },
        { name: "å£è„¾æ°£å“¥å¸ƒæ—", hp: 300, maxHp: 300, avatar: "ğŸ‘º", desc: "ç”Ÿæ°£çš„æ™‚å€™æœƒè®Šå¤§éš»å–”ï¼" },
        { name: "æ‹–å»¶å¤§é­”ç‹", hp: 500, maxHp: 500, avatar: "ğŸ‰", desc: "æœƒè®“ä½ èªªã€Œç­‰ä¸€ä¸‹ã€çš„å¯æ€•é­”ç‹" },
        { name: "é«’äº‚æ€ªç¸", hp: 800, maxHp: 800, avatar: "ğŸ§Ÿ", desc: "ä¸æ„›ä¹¾æ·¨çš„å°å­©æœƒè¢«ä»–æŠ“èµ°" },
        { name: "çµ‚æ¥µå¤§é­”ç¥", hp: 2000, maxHp: 2000, avatar: "ğŸ‘¿", desc: "åªæœ‰å‚³èªªä¸­çš„å…„å¦¹è¯æ‰‹æ‰èƒ½æ‰“æ•—ä»–" }
    ];

    // åˆå§‹è³‡æ–™
    const defaultData = {
        boy: { name: 'å“¥å“¥', score: 0, logs: [] },
        girl: { name: 'å¦¹å¦¹', score: 0, logs: [] },
        boss: { level: 0, currentHp: 100 } // é è¨­ç¬¬ä¸€éš»
    };

    let gameData = JSON.parse(localStorage.getItem('heroV3Data')) || defaultData;

    // --- åˆå§‹åŒ– ---
    initUI();
    renderBoss();

    function initUI() {
        renderPlayerPage('boy');
        renderPlayerPage('girl');
    }

    function switchPage(pageName) {
        // æ›´æ–° Tab æ¨£å¼
        document.querySelectorAll('.nav-item').forEach(el => {
            el.classList.remove('active-boy', 'active-girl', 'active-boss');
        });
        
        let activeClass = '';
        if(pageName === 'boy') activeClass = 'active-boy';
        if(pageName === 'girl') activeClass = 'active-girl';
        if(pageName === 'boss') activeClass = 'active-boss';
        
        // æ‰¾å‡ºè¢«é»æ“Šçš„æŒ‰éˆ•ä¸¦åŠ ä¸Šæ¨£å¼
        const tabs = document.querySelectorAll('.nav-item');
        if(pageName === 'boy') tabs[0].classList.add(activeClass);
        if(pageName === 'girl') tabs[1].classList.add(activeClass);
        if(pageName === 'boss') tabs[2].classList.add(activeClass);

        // æ›´æ–°é é¢é¡¯ç¤º
        document.querySelectorAll('.page').forEach(el => el.classList.remove('active'));
        document.getElementById(`page-${pageName}`).classList.add('active');

        // è¨­å®šç•¶å‰ç©å®¶
        if(pageName !== 'boss') {
            currentPlayer = pageName;
            document.body.className = `${pageName}-theme`;
        }
    }

    function renderPlayerPage(who) {
        const p = gameData[who];
        const container = document.getElementById(`page-${who}`);
        container.innerHTML = ''; // æ¸…ç©º

        // è¤‡è£½æ¨¡æ¿
        const template = document.getElementById('player-template');
        const clone = template.content.cloneNode(true);

        // å¡«å…¥è³‡æ–™
        clone.querySelector('.avatar').innerText = who === 'boy' ? 'ğŸ¦¸â€â™‚ï¸' : 'ğŸ§šâ€â™€ï¸';
        clone.querySelector('.player-score').innerText = p.score;
        
        // è¨ˆç®—ç­‰ç´šèˆ‡é‡Œç¨‹ç¢‘
        const nextMilestone = milestones.find(m => m.score > p.score) || { score: 9999, reward: "æˆç‚ºå‚³èªªï¼" };
        clone.querySelector('.next-reward').innerText = `ä¸‹å€‹çå‹µï¼š${nextMilestone.reward} (é‚„å·® ${nextMilestone.score - p.score} åˆ†)`;
        
        // é€²åº¦æ¢ (æ¯100åˆ†ä¸€å¾ªç’°)
        clone.querySelector('.progress-bar').style.width = `${(p.score % 100)}%`;

        // ç¶å®šæŒ‰éˆ•äº‹ä»¶ (å› ç‚º cloneNode æœƒå¤±å» onclick ç¶å®šï¼Œéœ€é‡æ–°åŒ…è£)
        // ç‚ºäº†ç°¡å–®ï¼Œç›´æ¥åœ¨ HTML ä½¿ç”¨å…¨åŸŸ functionï¼Œé€™è£¡åªéœ€æ¸²æŸ“ log
        
        const logArea = clone.querySelector('.log-area');
        logArea.innerHTML = p.logs.map(l => 
            `<div class="log-item"><span>${l.reason}</span><span>${l.points>0?'+':''}${l.points}</span></div>`
        ).join('');

        container.appendChild(clone);
    }

    // --- æ ¸å¿ƒé‚è¼¯ ---

    window.handleTask = function(points, reason) {
        const p = gameData[currentPlayer];
        
        // æ‰£åˆ†æª¢æŸ¥
        if (points < 0 && p.score + points < 0) {
            alert("é‡‘å¹£ä¸å¤ å–”ï¼ä¸èƒ½å…Œæ›ï¼");
            return;
        }

        // æ›´æ–°åˆ†æ•¸
        p.score += points;
        
        // ç´€éŒ„
        const time = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
        p.logs.unshift({ time, reason, points });
        if(p.logs.length > 20) p.logs.pop();

        // ** æ‰“æ€ªé‚è¼¯ **
        let bossMsg = "";
        if (points > 0) {
            const isDead = damageBoss(points);
            if (isDead) bossMsg = "\nğŸ‘¾ æ€ªç¸è¢«ä½ å€‘æ‰“æ•—äº†ï¼æ–°çš„æ€ªç¸å‡ºç¾äº†ï¼";
            else bossMsg = "\nâš”ï¸ çµ¦äºˆæ€ªç¸å‚·å®³ï¼";
        }

        saveData();
        renderPlayerPage(currentPlayer); // é‡æ–°æ¸²æŸ“ç•¶å‰é é¢
        renderBoss(); // æ›´æ–°æ€ªç¸ç‹€æ…‹
        
        // ç°¡å–®å›é¥‹
        // if(points > 0) alert(`å¤ªæ£’äº†ï¼${reason} æˆåŠŸï¼${bossMsg}`);
    }

    window.promptTask = function() {
        const reason = prompt("åšäº†ä»€éº¼å¥½äº‹æƒ…å‘¢ï¼Ÿ(ä¾‹å¦‚ï¼šå¹«å¿™æ‹¿ç¢—ç­·)", "å¹«å¿™åšå®¶äº‹");
        if (reason) {
            handleTask(10, reason); // é è¨­åŠ 10åˆ†
        }
    }

    function damageBoss(dmg) {
        const boss = gameData.boss;
        const currentMonster = monsters[boss.level] || monsters[monsters.length-1];
        
        boss.currentHp -= dmg;
        
        // å‹•ç•«ç‰¹æ•ˆ
        const avatar = document.getElementById('boss-avatar');
        if(avatar) {
            avatar.classList.remove('hit-effect');
            void avatar.offsetWidth; // trigger reflow
            avatar.classList.add('hit-effect');
        }

        // æ€ªç¸æ­»äº¡
        if (boss.currentHp <= 0) {
            boss.level++;
            if (boss.level >= monsters.length) boss.level = 0; // è¼ªè¿´æˆ–åœåœ¨æœ€å¾Œ
            // é‡ç½®è¡€é‡
            boss.currentHp = monsters[boss.level].maxHp;
            return true; // æ€ªç¸æ­»äº†
        }
        return false;
    }

    function renderBoss() {
        const bossIdx = gameData.boss.level >= monsters.length ? monsters.length - 1 : gameData.boss.level;
        const monster = monsters[bossIdx];
        const currentHp = gameData.boss.currentHp;

        document.getElementById('boss-name').innerText = monster.name;
        document.getElementById('boss-desc').innerText = monster.desc;
        document.getElementById('boss-avatar').innerText = monster.avatar;
        
        const hpPercent = Math.max(0, (currentHp / monster.maxHp) * 100);
        document.getElementById('boss-hp-bar').style.width = `${hpPercent}%`;
        document.getElementById('boss-hp-text').innerText = `${currentHp} / ${monster.maxHp}`;
    }

    function saveData() {
        localStorage.setItem('heroV3Data', JSON.stringify(gameData));
    }

    // è‡ªå‹•åˆ‡æ›åˆ°ç•¶å‰é é¢
    switchPage('boy'); 

</script>

</body>
</html>